# –û—Å–Ω–æ–≤—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

# –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
'''
–ü—Ä–µ–¥—Å—Ç–∞–≤–∏–º, —á—Ç–æ –º—ã –ø—Ä–∏—à–ª–∏ –≤ —Å–ø–æ—Ä—Ç–∏–≤–Ω—ã–π –∑–∞–ª –Ω–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É.

–®–∞–≥ 1. –ù–∞ –≤—Ö–æ–¥–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞—à –∞–±–æ–Ω–µ–º–µ–Ω—Ç - —ç—Ç–æ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è:
–º—ã –¥–æ–∫–∞–∑—ã–≤–∞–µ–º, –∫—Ç–æ –º—ã –µ—Å—Ç—å, –∏ —á—Ç–æ —É –Ω–∞—Å –µ—Å—Ç—å –ø—Ä–∞–≤–æ –ø—Ä–æ–π—Ç–∏ –¥–∞–ª—å—à–µ.
–í —Å—Ñ–µ—Ä–µ IT —ç—Ç–æ –º–æ–∂–Ω–æ —Å—Ä–∞–≤–Ω–∏—Ç—å —Å –≤–≤–æ–¥–æ–º –ª–æ–≥–∏–Ω–∞ –∏ –ø–∞—Ä–æ–ª—è - —Å–∏—Å—Ç–µ–º–∞ –ø–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –æ—Ç
–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ —Å–≤–µ—Ä—è–µ—Ç –∏—Ö —Å –¥–∞–Ω–Ω—ã–º–∏ –≤ –ë–î. –ï—Å–ª–∏ –≤—Å–µ —Å–æ–≤–ø–∞–ª–æ - –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ.

–®–∞–≥ 2. –ü–æ—Å–ª–µ –≤—Ö–æ–¥–∞ –≤ –∑–∞–ª –º—ã –º–æ–∂–µ–º –ø—Ä–æ–π—Ç–∏ –¥–∞–ª—å—à–µ, –Ω–æ –Ω–µ –≤ –ª—é–±—É—é –¥–≤–µ—Ä—å:
- —Ç—Ä–µ–Ω–∞–∂–µ—Ä–Ω—ã–π –∑–∞–ª - –¥–∞
- –±–∞—Å—Å–µ–π–Ω - –¥–∞
- –∫–æ–º–Ω–∞—Ç–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª–∞ - –Ω–µ—Ç
–≠—Ç–æ —É–∂–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è - —Å–∏—Å—Ç–µ–º–∞ —Ä–µ—à–∞–µ—Ç, —á—Ç–æ –Ω–∞–º —Ä–∞–∑—Ä–µ—à–µ–Ω–æ –¥–µ–ª–∞—Ç—å.

–í –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö, –∫–æ–≥–¥–∞ –º—ã –≤–≤–æ–¥–∏–º –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å, —Å–µ—Ä–≤–µ—Ä –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∏—Ö, –∏ –µ—Å–ª–∏ –≤—Å–µ —Ö–æ—Ä–æ—à–æ,
—Ç–æ –≤—ã–¥–∞–µ—Ç —Ç–æ–∫–µ–Ω - —Å–≤–æ–µ–≥–æ —Ä–æ–¥–∞ —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã–π –ø—Ä–æ–ø—É—Å–∫. –ß–∞—â–µ –≤—Å–µ–≥–æ —Ç–æ–∫–µ–Ω —è–≤–ª—è–µ—Ç—Å—è —Å—Ç—Ä–æ–∫–æ–π,
—Å–æ—Å—Ç–æ—è—â–µ–π –∏–∑ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ –Ω–∞–±–æ—Ä–∞ —Å–∏–º–≤–æ–ª–æ–≤. –ü—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ –º—ã –ø–æ–∫–∞–∑—ã–≤–∞–µ–º
—ç—Ç–æ—Ç —Ç–æ–∫–µ–Ω, –∏ —Å–µ—Ä–≤–µ—Ä –ø–æ–Ω–∏–º–∞–µ—Ç, —á—Ç–æ –º—ã —É–∂–µ –≤ —Å–∏—Å—Ç–µ–º–µ.

–í–∞–∂–Ω–æ –ø–æ–Ω–∏–º–∞—Ç—å, —á—Ç–æ —Ç–æ–∫–µ–Ω - —ç—Ç–æ –Ω–µ –ø–∞—Ä–æ–ª—å, –∞ –≤—Ä–µ–º–µ–Ω–Ω–æ–µ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ –≤—Ö–æ–¥–∞ –≤ —Å–∏—Å—Ç–µ–º—É.
–ï–≥–æ –Ω–µ–ª—å–∑—è —É–≥–∞–¥–∞—Ç—å, –∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ —Ç–æ–∫–µ–Ω –∂–∏–≤–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è.
–î–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –æ–±–º–µ–Ω–∞ —Ç–∞–∫–∏–º–∏ —Ç–æ–∫–µ–Ω–∞–º–∏ –º–µ–∂–¥—É –∫–ª–∏–µ–Ω—Ç–æ–º –∏ —Å–µ—Ä–≤–µ—Ä–æ–º —Å—É—â–µ—Å—Ç–≤—É–µ—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ç–æ–∫–æ–ª
–ø–æ–¥ –Ω–∞–∑–≤–∞–Ω–∏–µ–º OAuth2.

OAuth2 - –ø—Ä–æ—Ç–æ–∫–æ–ª –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏, –ø–æ–∑–≤–æ–ª—è—é—â–∏–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º –ø–æ–ª—É—á–∞—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø
–∫ —Ä–µ—Å—É—Ä—Å–∞–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ –¥—Ä—É–≥–æ–º —Å–µ—Ä–≤–∏—Å–µ –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø–µ—Ä–µ–¥–∞—á–∏ –µ–≥–æ —É—á–µ—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.
OAuth2 –ø–æ–∑–≤–æ–ª—è–µ—Ç:
- –≤—Ö–æ–¥–∏—Ç—å –ø–æ –ª–æ–≥–∏–Ω—É –∏ –ø–∞—Ä–æ–ª—é, –ø–æ–ª—É—á–∞—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π access token
- –Ω–µ —Ö—Ä–∞–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –∫–ª–∏–µ–Ω—Ç–∞
- –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ –∏ –æ–±–ª–∞—Å—Ç—å –¥–µ–π—Å—Ç–≤–∏—è —Ç–æ–∫–µ–Ω–∞

–ü—Ä–æ—Ç–æ–∫–æ–ª OAuth2 —à–∏—Ä–æ–∫–æ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω –≤ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –∏ –∞–∫—Ç–∏–≤–Ω–æ —Ä–∞–∑–≤–∏–≤–∞–µ—Ç—Å—è, 
–ø–æ—ç—Ç–æ–º—É –≤ FastAPI —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –Ω–∏–º. –û –Ω–∏—Ö –¥–∞–ª–µ–µ –∏ –ø–æ–π–¥–µ—Ç —Ä–µ—á—å.
'''

# ----------------------------------------------------------------------------------------------------

# OAuth2 –≤ FastAPI

# –ó–∞–¥–∞–Ω–∏–µ ‚Ññ 1 - —Å–æ–∑–¥–∞—Ç—å –±–∞–∑–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ–µ–∫—Ç–∞
'''
–ö–∞–∫ –º—ã —É–∂–µ –æ–±—Å—É–¥–∏–ª–∏ —Ä–∞–Ω–µ–µ, –≤ FastAPI –µ—Å—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–º OAuth2.
–ü—Ä–µ–∂–¥–µ, —á–µ–º –º—ã –±—É–¥–µ–º —Å –Ω–∏–º–∏ –∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è, –≤—ã—Å—Ç—Ä–æ–∏–º –±–∞–∑–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –Ω–∞—à–µ–≥–æ —Å–µ–≥–æ–¥–Ω—è—à–Ω–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞.
–í–ê–ñ–ù–´–ô –ú–û–ú–ï–ù–¢ - —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –Ω–∞–∑–≤–∞—Ç—å –ø—Ä–æ–µ–∫—Ç –≤ —Å—Ç–∏–ª–µ auth_app, —á—Ç–æ–±—ã –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏ –±—ã–ª–∏
—Ç–æ–ª—å–∫–æ –ª–∞—Ç–∏–Ω—Å–∫–∏–µ –±—É–∫–≤—ã –∏ —Å–∏–º–≤–æ–ª—ã –Ω–∏–∂–Ω–µ–≥–æ –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏—è –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏. –¢–∞–∫ –º—ã –∏–∑–±–µ–∂–∏–º
–ø—Ä–æ–±–ª–µ–º —Å –∏–º–ø–æ—Ä—Ç–∞–º–∏.

auth_app/ 
‚îú‚îÄ‚îÄ main.py         # —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îú‚îÄ‚îÄ security.py     # —Ä–∞–±–æ—Ç–∞ —Å —Ç–æ–∫–µ–Ω–∞–º–∏
‚îî‚îÄ‚îÄ routers/        # –ø–∞–ø–∫–∞ —Å —Ä–æ—É—Ç–µ—Ä–∞–º–∏
    ‚îî‚îÄ‚îÄ users.py    # –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

–ü–æ–∫–∞ —á—Ç–æ –º—ã —Å–æ–∑–¥–∞–ª–∏ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –Ω–∞–±–æ—Ä —Ñ–∞–π–ª–æ–≤, –Ω–æ –≤ —Ç–µ—á–µ–Ω–∏–µ –∑–∞–Ω—è—Ç–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–æ–≤
–±—É–¥–µ—Ç —É–≤–µ–ª–∏—á–∏–≤–∞—Ç—å—Å—è.

–ù–∞—á–Ω–µ–º —Å —Ñ–∞–π–ª–∞ security.py, –≥–¥–µ –ø–æ–¥–∫–ª—é—á–∏–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –≤ FastAPI –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å OAuth2.
'''

# –ó–∞–¥–∞–Ω–∏–µ ‚Ññ 2 - —Å–æ–∑–¥–∞—Ç—å –±–∞–∑–æ–≤–æ–µ –Ω–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–ª—è auth_app/security.py

# auth_app/security.py

# OAuth2PasswordBearer - –∫–ª–∞—Å—Å –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–æ –ø–∞—Ä–æ–ª—é —á–µ—Ä–µ–∑ –ø—Ä–æ—Ç–æ–∫–æ–ª OAuth2.
# –≠–∫–∑–µ–º–ø–ª—è—Ä –∫–ª–∞—Å—Å–∞ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç URL –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞ –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ 
# —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–≥–æ —Ç–æ–∫–µ–Ω–∞ Bearer (–Ω–æ—Å–∏—Ç–µ–ª—å) –∏–∑ –∑–∞–ø—Ä–æ—Å–æ–≤.
from fastapi.security import OAuth2PasswordBearer

# –°–æ–∑–¥–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä –∫–ª–∞—Å—Å–∞ OAuth2PasswordBearer. –ü–∞—Ä–∞–º–µ—Ç—Ä tokenUrl='token' —Å–æ–¥–µ—Ä–∂–∏—Ç URL, 
# –∫–æ—Ç–æ—Ä—ã–π –∫–ª–∏–µ–Ω—Ç –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ username –∏ password, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω 
oauth2_scheme = OAuth2PasswordBearer(tokenUrl='token')

'''
–ü–æ–∫–∞ —Å security.py –≤—Å–µ, –∫ –Ω–µ–º—É –º—ã –µ—â–µ –≤–µ—Ä–Ω–µ–º—Å—è. 
'''

# –ó–∞–¥–∞–Ω–∏–µ ‚Ññ 3 - —Å–æ–∑–¥–∞—Ç—å –±–∞–∑–æ–≤–æ–µ –Ω–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–ª—è auth_app/routers/users.py
'''
–¢–µ–ø–µ—Ä—å –ø–æ–π–¥–µ–º –≤ routers/users.py –∏ –æ—Ñ–æ—Ä–º–∏–º
–ø–µ—Ä–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —ç–Ω–¥–ø–æ–∏–Ω—Ç.
–í–ê–ñ–ù–´–ô –ú–û–ú–ï–ù–¢ - –≤ –∏–º–ø–æ—Ä—Ç–∞—Ö –∏–∑ –Ω–∞–ø–∏—Å–∞–Ω–Ω—ã—Ö –Ω–∞–º–∏ –º–æ–¥—É–ª–µ–π –º—ã –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
–∞–±—Å–æ–ª—é—Ç–Ω—É—é –∞–¥—Ä–µ—Å–∞—Ü–∏—é, –≤—ã —ç—Ç–æ —É–≤–∏–¥–∏—Ç–µ –Ω–∞ –ø—Ä–∏–º–µ—Ä–µ –∏–º–ø–æ—Ä—Ç–∞ oauth2_scheme –∏–∑ security.py.
'''
# auth_app/routers/users.py

# –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ä–æ—É—Ç–µ—Ä–∞ –∏ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
from fastapi import APIRouter, Depends
# –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º oauth2_scheme –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ —Ä–æ–ª–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤–Ω—É—Ç—Ä–∏ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞
from auth_app.security import oauth2_scheme

# —Å–æ–∑–¥–∞–µ–º —Ä–æ—É—Ç–µ—Ä —Å —Ç–µ–≥–æ–º users
router = APIRouter(tags=['users'])

# –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º GET-–∑–∞–ø—Ä–æ—Å –ø–æ –º–∞—Ä—à—Ä—É—Ç—É /items
@router.get('/items')
# —É–∫–∞–∑—ã–≤–∞–µ–º oauth2_scheme –∫–∞–∫ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞ –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞ Authorization: Bearer
async def get_items(token: str = Depends(oauth2_scheme)):
    # –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ –ø—Ä–∏–º–µ—Ä–∞ –ø—Ä–æ—Å—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –ø–æ–ª—É—á–µ–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω
    return {'token': token}

'''
–° routers/users.py –ø–æ–∫–∞ –æ—Å—Ç–∞–Ω–æ–≤–∏–º—Å—è, –æ—Å—Ç–∞–ª–æ—Å—å –æ—Ñ–æ—Ä–º–∏—Ç—å main.py, –≥–¥–µ –º—ã —Å–æ–∑–¥–∞–¥–∏–º —ç–∫–∑–µ–º–ø–ª—è—Ä –∫–ª–∞—Å—Å–∞ FastAPI
–∏ –ø–æ–¥–∫–ª—é—á–∏–º —Ä–æ—É—Ç–µ—Ä –∏–∑ routers/users.py:
'''

# –ó–∞–¥–∞–Ω–∏–µ ‚Ññ 4 - —Å–æ–∑–¥–∞—Ç—å –±–∞–∑–æ–≤–æ–µ –Ω–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–ª—è auth_app/main.py

# auth_app/main.py

from fastapi import FastAPI
# –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –º–æ–¥—É–ª—å users.py –∏–∑ –ø–∞–ø–∫–∏ routers/
from auth_app.routers import users

app = FastAPI()

# –ø–æ–¥–∫–ª—é—á–∞–µ–º —Ä–æ—É—Ç–µ—Ä –∏–∑ –º–æ–¥—É–ª—è users.py
app.include_router(users.router)

'''
–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∫–æ–¥ –≥–æ—Ç–æ–≤, –∑–∞–ø—É—Å—Ç–∏–º –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–µ–º –Ω–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:
uvicorn auth_app.main:app --reload

–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ —Å–≤–µ—Ä—Ö—É —Å–ø—Ä–∞–≤–∫–∞ –ø–æ—è–≤–∏–ª–∞—Å—å –∫–Ω–æ–ø–∫–∞ —Å –∑–∞–º–æ—á–∫–æ–º –∏ –Ω–∞–¥–ø–∏—Å—å—é Authorize.
–ï—Å–ª–∏ –º—ã –µ–µ –Ω–∞–∂–º–µ–º, —Ç–æ —É –Ω–∞—Å –æ—Ç–∫—Ä–æ–µ—Ç—Å—è —Ñ–æ—Ä–º–∞, –∫—É–¥–∞ –º–æ–∂–Ω–æ –≤–≤–µ—Å—Ç–∏ username –∏ password –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
–∏ –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞. –ü–æ–∫–∞ —á—Ç–æ —É –Ω–∞—Å –Ω–µ—Ç –Ω–∏–∫–∞–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö, –ø–æ—ç—Ç–æ–º—É –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ–∫–∞
—Ä–∞–±–æ—Ç–∞—Ç—å –Ω–µ –±—É–¥–µ—Ç. –ò —Ç–æ—Ç —Ñ–∞–∫—Ç, —á—Ç–æ –º—ã –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã, –º–æ–∂–Ω–æ —É–≤–∏–¥–µ—Ç—å —á–µ—Ä–µ–∑ —ç–Ω–¥–ø–æ–∏–Ω—Ç GET /items.
–ï—Å–ª–∏ –º—ã –ø–æ–ø—Ä–æ–±—É–µ–º –µ–≥–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å, —Ç–æ –ø–æ–ª—É—á–∏–º –æ—Ç–≤–µ—Ç —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º 401 –∏ —Ç–µ–ª–æ–º {"detail": "Not authenticated"}.
'''

# ----------------------------------------------------------------------------------------------------

# –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
'''
–°–µ–π—á–∞—Å —É –Ω–∞—Å –µ—Å—Ç—å —ç–Ω–¥–ø–æ–∏–Ω—Ç –≤ routers/users.py –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
–î–æ–±–∞–≤–∏–º –±–æ–ª–µ–µ –ø–æ–ª–µ–∑–Ω—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç, —Å –ø–æ–º–æ—â—å—é –∫–æ—Ç–æ—Ä–æ–≥–æ —Å–º–æ–∂–µ–º –ø–æ–ª—É—á–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ.
–î–ª—è —ç—Ç–æ–≥–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∞–∂–Ω—ã—Ö –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–π –∏ –ø–µ—Ä–≤–æ–µ - —ç—Ç–æ —Å–æ–∑–¥–∞—Ç—å Pydantic-–º–æ–¥–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
–°–æ–∑–¥–∞–¥–∏–º –Ω–æ–≤—ã–π —Ñ–∞–π–ª —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º models.py –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ auth_app/ –∏ –æ–ø–∏—à–µ–º –º–æ–¥–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
'''

# –ó–∞–¥–∞–Ω–∏–µ ‚Ññ 5 - —Å–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª auth_app/models.py

# auth_app/models.py

from pydantic import BaseModel

# Pydantic-–º–æ–¥–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏—è –≤ –æ—Ç–≤–µ—Ç–µ
class User(BaseModel):
    username: str                   # username –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    email: str | None = None        # –∞–¥—Ä–µ—Å —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –ø–æ—á—Ç—ã
    is_active: bool | None = None   # –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–∫—Ç–∏–≤–µ–Ω –≤ —Å–∏—Å—Ç–µ–º–µ –∏–ª–∏ –Ω–µ—Ç

'''
–¢–∞–∫–∂–µ –Ω–∞–º –ø–æ–Ω–∞–¥–æ–±—è—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –≤—ã—Å—Ç—É–ø–∞—Ç—å –≤ —Ä–æ–ª–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π.
–û–¥–Ω—É –∏–∑ —Ñ—É–Ω–∫—Ü–∏–π –æ–±—ä—è–≤–∏–º –≤ —É–∂–µ –∏–º–µ—é—â–µ–º—Å—è —Ñ–∞–π–ª–µ security.py, –µ–µ –∑–∞–¥–∞—á–∞ - –ø—Ä–∏–Ω–∏–º–∞—Ç—å —Ç–æ–∫–µ–Ω –∏ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å —ç–∫–∑–µ–º–ø–ª—è—Ä –∫–ª–∞—Å—Å–∞ User:
'''

# –ó–∞–¥–∞–Ω–∏–µ ‚Ññ 6 - –¥–æ–ø–æ–ª–Ω–∏—Ç—å —Ñ–∞–π–ª auth_app/security.py

# auth_app/security.py
...
# –ø–æ–¥–∫–ª—é—á–∞–µ–º –º–æ–¥–µ–ª—å User –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
from auth_app.models import User
...
# —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –∏–º–∏—Ç–∞—Ü–∏–∏ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–æ–∫–µ–Ω–∞ –∏ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
def decode_token(token: str):
    return User(
        username=token + 'decoded',
        email='dima@mail.ru'
    )

'''
–î–∞–ª–µ–µ —Å–æ–∑–¥–∞–¥–∏–º –µ—â–µ –æ–¥–∏–Ω –Ω–æ–≤—ã–π —Ñ–∞–π–ª - deps.py, –≥–¥–µ –æ–±—ä—è–≤–∏–º –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é —Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å—é
oauth2_scheme –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –≤–Ω—É—Ç—Ä–∏ —Ñ—É–Ω–∫—Ü–∏–∏ decode_token() –¥–ª—è –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏—è –ø—Ä–æ–≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö
–¥–∞–Ω–Ω—ã—Ö –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ:
'''

# –ó–∞–¥–∞–Ω–∏–µ ‚Ññ 7 - —Å–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª auth_app/deps.py

# auth_app/deps.py

# –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
from fastapi import Depends
from auth_app.security import oauth2_scheme, decode_token

# —É–∫–∞–∑—ã–≤–∞–µ–º oauth2_scheme –∫–∞–∫ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞
async def get_current_user(token: str = Depends(oauth2_scheme)):
    # –ø–æ–ª—É—á–∞–µ–º –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –¥–∞–Ω–Ω—ã–µ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ –ø–æ —É–∫–∞–∑–∞–Ω–Ω–æ–º—É —Ç–æ–∫–µ–Ω—É
    user = decode_token(token)
    return user

'''
–û—Å—Ç–∞–ª–æ—Å—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —ç–Ω–¥–ø–æ–∏–Ω—Ç, —á–µ—Ä–µ–∑ –∫–æ—Ç–æ—Ä—ã–π –∫–ª–∏–µ–Ω—Ç —Å–º–æ–∂–µ—Ç –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ.
–î–∞–Ω–Ω—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç —Å–æ–∑–¥–∞–¥–∏–º –≤ —É–∂–µ –∏–º–µ—é—â–µ–º—Å—è —Ñ–∞–π–ª–µ routers/users.py:
'''

# –ó–∞–¥–∞–Ω–∏–µ ‚Ññ 8 - –¥–æ–ø–æ–ª–Ω–∏—Ç—å —Ñ–∞–π–ª auth_app/routers/users.py

# auth_app/routers/users.py
...
# –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º get_current_user() –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
from auth_app.deps import get_current_user
# –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –º–æ–¥–µ–ª—å User –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
from auth_app.models import User
...
# –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º GET-–∑–∞–ø—Ä–æ—Å –ø–æ –º–∞—Ä—à—Ä—É—Ç—É /users/profile
@router.get('/users/profile')
# –ø–µ—Ä–µ–¥–∞–µ–º get_current_user() –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
async def get_users_profile(current_user: User = Depends(get_current_user)):
    # –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –¥–∞–Ω–Ω—ã–µ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
    return current_user

'''
–ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –∫–æ–¥–∞ –æ–±—Å—É–¥–∏–º, –¥–ª—è —á–µ–≥–æ –∂–µ –º—ã —Å–æ–∑–¥–∞–ª–∏ —Ç–µ –¥–≤–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ –æ–¥–∏–Ω —ç–Ω–¥–ø–æ–∏–Ω—Ç.
–ë–ª–∞–≥–æ–¥–∞—Ä—è —Ç–∞–∫–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ, –º—ã –º–æ–∂–µ–º –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º–∏ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è 
–Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ —á–µ—Ä–µ–∑ —ç–Ω–¥–ø–æ–∏–Ω—Ç –∏ —É–ø—Ä–∞–≤–ª—è—Ç—å –º–µ—Ö–∞–Ω–∏–∑–º–∞–º–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –Ω–∞ —É—Ä–æ–≤–Ω–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π.
–ü—Ä–∏ —ç—Ç–æ–º –º—ã –º–æ–∂–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª—é–±—É—é –º–æ–¥–µ–ª—å –∏ –ª—é–±—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (—Å–µ–π—á–∞—Å
–º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º Pydantic-–º–æ–¥–µ–ª—å User).

–ò –≤ –¥–∞–ª—å–Ω–µ–π—à–µ–º –º—ã –º–æ–∂–µ–º —Å–æ–∑–¥–∞–≤–∞—Ç—å –º–Ω–æ–∂–µ—Å—Ç–≤–æ —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–∞–ø–∏—Å–∞–Ω–Ω—É—é
–ª–æ–≥–∏–∫—É –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ - —ç—Ç–æ –≤–æ–∑–º–æ–∂–Ω–æ –±–ª–∞–≥–æ–¥–∞—Ä—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–º—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π.
–ò–º–µ–Ω–Ω–æ –ø–æ—ç—Ç–æ–º—É –Ω–∞—à —ç–Ω–¥–ø–æ–∏–Ω—Ç get_users_profile() –∑–∞–Ω–∏–º–∞–µ—Ç –≤—Å–µ–≥–æ 3 —Å—Ç—Ä–æ—á–∫–∏ –∫–æ–¥–∞.

–ï—Å–ª–∏, –µ—Å–ª–∏ –º—ã –∑–∞–ø—É—Å—Ç–∏–º –∫–æ–¥ –∏ –æ—Ç–∫—Ä–æ–µ–º –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é, —Ç–æ —É–≤–∏–¥–∏–º –Ω–æ–≤—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç GET /users/profile.
–ù–æ —Ä–∞–±–æ—Ç–∞—Ç—å –æ–Ω, —É–≤—ã, –Ω–µ –±—É–¥–µ—Ç. –ú–æ–∂–µ—Ç –ø–æ–∫–∞–∑–∞—Ç—å—Å—è, —á—Ç–æ –≤–µ—Å—å –Ω–∞–ø–∏—Å–∞–Ω–Ω—ã–π –∫–æ–¥ –Ω–∏—á–µ–≥–æ –Ω–∞–º –Ω–µ –¥–∞–µ—Ç, –Ω–æ
—ç—Ç–æ –Ω–µ —Ç–∞–∫. –ù–∞–º –ª–∏—à—å –æ—Å—Ç–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å —Ö—Ä–∞–Ω–∏–ª–∏—â–µ —Å –¥–∞–Ω–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –∞ —Ç–∞–∫–∂–µ –æ–±–µ—Å–ø–µ—á–∏—Ç—å –¥–ª—è
–∫–ª–∏–µ–Ω—Ç–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–ø—Ä–∞–≤–∫–∏ username –∏ password –Ω–∞ —Å–µ—Ä–≤–µ—Ä. 
–≠—Ç–∏–º –º—ã –∑–∞–π–º–µ–º—Å—è —É–∂–µ –Ω–∞ —Å–ª–µ–¥—É—é—â–µ–º –∑–∞–Ω—è—Ç–∏–∏ üòâ
'''